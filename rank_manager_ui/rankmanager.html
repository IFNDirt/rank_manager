<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Rank Manager UI</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/ifndirt/rank_manager@main/rank_manager_ui/style.css" />
</head>
<body>
    <div id="app">
        <div id="player-list" class="player-list">
            <h2>Rank Manager</h2>
            <p>Loading...</p>
        </div>
        <div id="player-detail" class="player-detail"></div>
    </div>

    <div id="modal-container" class="modal-container" style="display: none;">
        <div class="modal-overlay"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modal-title" class="modal-title"></h3>
                <button id="modal-close" class="modal-close">Ã—</button>
            </div>
            <div id="modal-body" class="modal-body"></div>
        </div>
    </div>

    <script>
        // Get server URL dynamically (works for both singleplayer and multiplayer)
        function getServerURL() {
            // Try to get from window.location if available
            if (window.location && window.location.hostname) {
                return `http://${window.location.hostname}:${window.location.port || 27015}`;
            }
            // Fallback to localhost for singleplayer
            return "http://localhost:27015";
        }
        
        // Load state from HTTP server (Garry's Mod serves data/ folder)
        const serverURL = getServerURL();
        fetch(`${serverURL}/data/rankmanager_ui/state.json`)
            .then(response => {
                if (!response.ok) {
                    throw new Error('Failed to load state file');
                }
                return response.json();
            })
            .then(state => {
                console.log("Loaded state:", state);
                // Make state available globally for app.js to use
                window.INITIAL_STATE = state;
                // Load the main app script
                const script = document.createElement('script');
                script.src = "https://cdn.jsdelivr.net/gh/ifndirt/rank_manager@main/rank_manager_ui/ui.js";
                document.head.appendChild(script);
            })
            .catch(error => {
                console.error("Failed to load state:", error);
                // Show error message
                document.getElementById('app').innerHTML = `
                    <div style="text-align: center; padding: 20px;">
                        <h2>Rank Manager</h2>
                        <p>Failed to load state data. Please try again.</p>
                        <p style="color: #888; font-size: 12px;">Error: ${error.message}</p>
                        <p style="color: #888; font-size: 12px;">Server URL: ${serverURL}</p>
                    </div>
                `;
            });
    </script>
</body>
</html> 